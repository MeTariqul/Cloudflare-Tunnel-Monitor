{% extends "base.html" %}

{% block title %}Dashboard - Cloudflare Tunnel Monitor{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Control Panel -->
    <section class="panel control-panel">
        <h2><i class="fas fa-server"></i> Tunnel Control</h2>
        <div class="button-group">
            <button id="start-button" class="btn btn-primary"><i class="fas fa-play"></i> Start Tunnel</button>
            <button id="stop-button" class="btn btn-danger" disabled><i class="fas fa-stop"></i> Stop Tunnel</button>
            <button id="test-whatsapp-button" class="btn btn-info"><i class="fab fa-whatsapp"></i> Test WhatsApp</button>
        </div>

        <div class="status-indicators">
            <div class="status-item">
                <span class="status-label">Tunnel Status:</span>
                <span class="status-indicator" id="tunnel-status-indicator"></span>
                <span class="status-text" id="tunnel-status-text">Stopped</span>
            </div>
            <div class="status-item">
                <span class="status-label">Internet Status:</span>
                <span class="status-indicator" id="internet-status-indicator"></span>
                <span class="status-text" id="internet-status-text">Checking...</span>
            </div>
            <div class="status-item">
                <span class="status-label">Ping to 1.1.1.1:</span>
                <span class="ping-value" id="ping-value">Checking...</span>
            </div>
        </div>
    </section>

    <!-- Statistics Panel -->
    <section class="panel stats-panel">
        <h2><i class="fas fa-chart-line"></i> Statistics</h2>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-play-circle"></i></div>
                <div class="stat-info">
                    <span class="stat-label">Tunnel Starts</span>
                    <span class="stat-value" id="tunnel-starts">0</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-paper-plane"></i></div>
                <div class="stat-info">
                    <span class="stat-label">Messages Sent</span>
                    <span class="stat-value" id="messages-sent">0</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-wifi"></i></div>
                <div class="stat-info">
                    <span class="stat-label">Internet Disconnects</span>
                    <span class="stat-value" id="internet-disconnects">0</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                <div class="stat-info">
                    <span class="stat-label">Uptime</span>
                    <span class="stat-value" id="uptime">00:00:00</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
                <div class="stat-info">
                    <span class="stat-label">Last Check</span>
                    <span class="stat-value" id="last-check">N/A</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Tunnel Info Panel -->
    <section class="panel tunnel-info-panel">
        <h2><i class="fas fa-info-circle"></i> Tunnel Information</h2>
        
        <!-- Tunnel URL Section -->
        <div class="info-section">
            <h3>Current Tunnel URL</h3>
            <div class="url-display">
                <input type="text" id="tunnel-url" value="Not available" readonly>
                <button id="copy-url-button" class="btn btn-secondary"><i class="fas fa-copy"></i> Copy URL</button>
            </div>
        </div>

        <!-- QR Code Section -->
        <div class="info-section">
            <h3>Scan QR Code to Access Tunnel</h3>
            <div id="qrcode" class="qrcode-container">
                <div class="qrcode-placeholder">QR Code will appear when tunnel is active</div>
            </div>
        </div>

        <!-- WhatsApp Info Section -->
        <div class="info-section">
            <h3>WhatsApp Configuration</h3>
            <div class="whatsapp-info">
                <div class="info-item">
                    <span class="info-label">Contact:</span>
                    <span class="info-value" id="whatsapp-contact">{{ config.whatsapp_contact }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Message Template:</span>
                    <span class="info-value message-template">{{ config.message_template }}</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Ping Chart Panel -->
    <section class="panel ping-chart-panel">
        <h2><i class="fas fa-chart-line"></i> Live Ping Monitor</h2>
        <div class="ping-chart-container">
            <canvas id="ping-chart"></canvas>
        </div>
    </section>

    <!-- Recent Logs Panel -->
    <section class="panel recent-logs-panel">
        <h2><i class="fas fa-list-alt"></i> Recent Activity</h2>
        <div class="recent-logs">
            <div id="recent-logs-container" class="logs-container">
                <div class="log-entry placeholder">No recent activity</div>
            </div>
        </div>
        <div class="view-all">
            <a href="{{ url_for('logs') }}" class="btn btn-text">View All Logs <i class="fas fa-arrow-right"></i></a>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}